FROM java:8-jre

RUN { \
	set -ex; \

	# add user & group
	groupadd --system --gid 1000 commafeed; \
	useradd --system --uid 1000 --gid 1000 commafeed; \

	# install gosu
	curl \
		-o /usr/bin/gosu \
		-fsSL \
		"https://github.com/tianon/gosu/releases/download/1.7/gosu-$(dpkg --print-architecture)"; \
	chmod +x /usr/bin/gosu; \
}

ADD https://github.com/Athou/commafeed/releases/download/2.3.0/commafeed.jar /opt/commafeed.jar

VOLUME /data/commafeed

COPY commafeed.yaml /etc/

COPY start-commafeed /usr/bin
CMD ["start-commafeed"]
